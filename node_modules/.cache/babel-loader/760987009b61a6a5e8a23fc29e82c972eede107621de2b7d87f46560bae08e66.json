{"ast":null,"code":"import { mapState } from 'pinia';\nimport { useSettingStore } from '../store/settings';\nimport { videoController } from '../utility/video-controller';\nimport { database } from '../database/firebase';\nimport { ref, onValue } from 'firebase/database';\nconst UNRAVEL = '7aMOurgDB-o';\nexport default {\n  name: 'YoutubeVideo',\n  data() {\n    return {\n      player: null\n    };\n  },\n  computed: {\n    ...mapState(useSettingStore, ['autopause']),\n    isYoutubePlayerInstalled() {\n      return window.YT && window.YT.loaded;\n    }\n  },\n  props: {\n    videoId: {\n      type: String,\n      default: ''\n    }\n  },\n  mounted() {\n    this.loadYoutubePlayer();\n  },\n  methods: {\n    loadYouTubeAPI() {\n      const tag = document.createElement('script');\n      tag.src = \"https://www.youtube.com/iframe_api\";\n      const firstScriptTag = document.getElementsByTagName('script')[0];\n      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    },\n    loadYoutubePlayer() {\n      if (!this.isYoutubePlayerInstalled) {\n        this.loadYouTubeAPI();\n      }\n      const videoId = this.videoId || UNRAVEL;\n      window.onYouTubeIframeAPIReady = () => {\n        const playerOptions = {\n          height: '500px',\n          width: '500px',\n          videoId,\n          playerVars: {\n            'controls': 1,\n            'rel': 0,\n            'autoplay': this.autopause ? 0 : 1,\n            'origin': 'https://www.youtube.com'\n          },\n          events: {\n            'onReady': this.onPlayerReady,\n            'onStateChange': this.onPlayerStateChange,\n            'onApiChange': this.onApiChange\n          }\n        };\n        this.player = new YT.Player('player', playerOptions);\n      };\n    },\n    onPlayerStateChange(event) {\n      if (event.data === 0) {\n        console.warn('Video Ended');\n        videoController.playNextSong();\n      }\n    },\n    onPlayerReady() {\n      const currentSong = ref(database, '/currentSong');\n      onValue(currentSong, snapshot => {\n        const song = snapshot.val();\n        this.$store.playlist.changeCurrentSongBySong(song);\n      });\n    },\n    onVideoIdChange() {\n      if (!this.player) {\n        this.loadYoutubePlayer();\n      }\n      if (this.autopause) {\n        console.log(this.player);\n        this.player.cueVideoById(this.videoId);\n      } else {\n        this.player.loadVideoById(this.videoId);\n      }\n    }\n  },\n  watch: {\n    videoId() {\n      this.onVideoIdChange();\n    }\n  }\n};","map":{"version":3,"names":["mapState","useSettingStore","videoController","database","ref","onValue","UNRAVEL","name","data","player","computed","isYoutubePlayerInstalled","window","YT","loaded","props","videoId","type","String","default","mounted","loadYoutubePlayer","methods","loadYouTubeAPI","tag","document","createElement","src","firstScriptTag","getElementsByTagName","parentNode","insertBefore","onYouTubeIframeAPIReady","playerOptions","height","width","playerVars","autopause","events","onPlayerReady","onPlayerStateChange","onApiChange","Player","event","console","warn","playNextSong","currentSong","snapshot","song","val","$store","playlist","changeCurrentSongBySong","onVideoIdChange","log","cueVideoById","loadVideoById","watch"],"sources":["X:\\Coding\\MyTube\\src\\components\\YoutubeVideo.vue"],"sourcesContent":["<template lang=\"pug\">\r\n.youtube-player(tabindex=\"-1\")\r\n\t#player(tabindex=\"-1\")\r\n</template>\r\n\r\n<script>\r\nimport { mapState } from 'pinia'\r\nimport { useSettingStore } from '../store/settings'\r\nimport {videoController} from '../utility/video-controller'\r\nimport { database } from '../database/firebase'\r\nimport {ref, onValue} from 'firebase/database'\r\nconst UNRAVEL = '7aMOurgDB-o'\r\n\r\nexport default {\r\n\tname: 'YoutubeVideo',\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tplayer: null\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapState(useSettingStore, ['autopause']),\r\n\r\n\t\tisYoutubePlayerInstalled() {\r\n\t\t\treturn window.YT && window.YT.loaded\r\n\t\t}\r\n\t},\r\n\tprops: {\r\n\t\tvideoId: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: ''\r\n\t\t}\r\n\t},\r\n\tmounted() {\r\n\t\tthis.loadYoutubePlayer()\r\n\t},\r\n\tmethods: {\r\n\t\tloadYouTubeAPI() {\r\n\t\t\tconst tag = document.createElement('script')\r\n\t\t\ttag.src = \"https://www.youtube.com/iframe_api\"\r\n\t\t\tconst firstScriptTag = document.getElementsByTagName('script')[0]\r\n\t\t\tfirstScriptTag.parentNode.insertBefore(tag, firstScriptTag)\r\n\t\t},\r\n\t\tloadYoutubePlayer() {\r\n\t\t\tif (!this.isYoutubePlayerInstalled) {\r\n\t\t\t\tthis.loadYouTubeAPI()\r\n\t\t\t}\r\n\t\t\tconst videoId = this.videoId || UNRAVEL\r\n\t\t\twindow.onYouTubeIframeAPIReady = () => {\r\n\t\t\t\tconst playerOptions = {\r\n\t\t\t\t\theight: '500px',\r\n\t\t\t\t\twidth: '500px',\r\n\t\t\t\t\tvideoId,\r\n\t\t\t\t\tplayerVars: {\r\n\t\t\t\t\t\t'controls': 1,\r\n\t\t\t\t\t\t'rel': 0,\r\n\t\t\t\t\t\t'autoplay': this.autopause ? 0 : 1,\r\n\t\t\t\t\t\t'origin': 'https://www.youtube.com'\r\n\t\t\t\t\t},\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\t'onReady': this.onPlayerReady,\r\n\t\t\t\t\t\t'onStateChange': this.onPlayerStateChange,\r\n\t\t\t\t\t\t'onApiChange': this.onApiChange\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.player = new YT.Player('player', playerOptions)\r\n\t\t\t}\r\n\t\t},\r\n\t\tonPlayerStateChange(event) {\r\n\t\t\tif (event.data === 0) {\r\n\t\t\t\tconsole.warn('Video Ended')\r\n\t\t\t\tvideoController.playNextSong()\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tonPlayerReady() {\r\n\t\t\tconst currentSong = ref(database, '/currentSong')\r\n\t\t\tonValue(currentSong, (snapshot) => {\r\n\t\t\t\tconst song = snapshot.val()\r\n\t\t\t\tthis.$store.playlist.changeCurrentSongBySong(song)\r\n\t\t\t})\r\n\t\t},\r\n\t\tonVideoIdChange() {\r\n\t\t\tif (!this.player) {\r\n\t\t\t\tthis.loadYoutubePlayer()\r\n\t\t\t}\r\n\t\t\tif (this.autopause) {\r\n\t\t\t\tconsole.log(this.player);\r\n\t\t\t\tthis.player.cueVideoById(this.videoId)\r\n\t\t\t} else {\r\n\t\t\t\tthis.player.loadVideoById(this.videoId)\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n\twatch: {\r\n\t\tvideoId() {\r\n\t\t\tthis.onVideoIdChange()\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n<style scoped lang=\"scss\">\r\n@import 'src/styles/flex';\r\n\r\n.youtube-player {\r\n\t@include flex-center();\r\n\r\n\t.info {\r\n\t\t@include flex-column();\r\n\t\tcolor: white;\r\n\t}\r\n}\r\n</style>\r\n"],"mappings":"AAMA,SAASA,QAAO,QAAS,OAAM;AAC/B,SAASC,eAAc,QAAS,mBAAkB;AAClD,SAAQC,eAAe,QAAO,6BAA4B;AAC1D,SAASC,QAAO,QAAS,sBAAqB;AAC9C,SAAQC,GAAG,EAAEC,OAAO,QAAO,mBAAkB;AAC7C,MAAMC,OAAM,GAAI,aAAY;AAE5B,eAAe;EACdC,IAAI,EAAE,cAAc;EACpBC,IAAIA,CAAA,EAAG;IACN,OAAO;MACNC,MAAM,EAAE;IACT;EACD,CAAC;EACDC,QAAQ,EAAE;IACT,GAAGV,QAAQ,CAACC,eAAe,EAAE,CAAC,WAAW,CAAC,CAAC;IAE3CU,wBAAwBA,CAAA,EAAG;MAC1B,OAAOC,MAAM,CAACC,EAAC,IAAKD,MAAM,CAACC,EAAE,CAACC,MAAK;IACpC;EACD,CAAC;EACDC,KAAK,EAAE;IACNC,OAAO,EAAE;MACRC,IAAI,EAAEC,MAAM;MACZC,OAAO,EAAE;IACV;EACD,CAAC;EACDC,OAAOA,CAAA,EAAG;IACT,IAAI,CAACC,iBAAiB,CAAC;EACxB,CAAC;EACDC,OAAO,EAAE;IACRC,cAAcA,CAAA,EAAG;MAChB,MAAMC,GAAE,GAAIC,QAAQ,CAACC,aAAa,CAAC,QAAQ;MAC3CF,GAAG,CAACG,GAAE,GAAI,oCAAmC;MAC7C,MAAMC,cAAa,GAAIH,QAAQ,CAACI,oBAAoB,CAAC,QAAQ,CAAC,CAAC,CAAC;MAChED,cAAc,CAACE,UAAU,CAACC,YAAY,CAACP,GAAG,EAAEI,cAAc;IAC3D,CAAC;IACDP,iBAAiBA,CAAA,EAAG;MACnB,IAAI,CAAC,IAAI,CAACV,wBAAwB,EAAE;QACnC,IAAI,CAACY,cAAc,CAAC;MACrB;MACA,MAAMP,OAAM,GAAI,IAAI,CAACA,OAAM,IAAKV,OAAM;MACtCM,MAAM,CAACoB,uBAAsB,GAAI,MAAM;QACtC,MAAMC,aAAY,GAAI;UACrBC,MAAM,EAAE,OAAO;UACfC,KAAK,EAAE,OAAO;UACdnB,OAAO;UACPoB,UAAU,EAAE;YACX,UAAU,EAAE,CAAC;YACb,KAAK,EAAE,CAAC;YACR,UAAU,EAAE,IAAI,CAACC,SAAQ,GAAI,IAAI,CAAC;YAClC,QAAQ,EAAE;UACX,CAAC;UACDC,MAAM,EAAE;YACP,SAAS,EAAE,IAAI,CAACC,aAAa;YAC7B,eAAe,EAAE,IAAI,CAACC,mBAAmB;YACzC,aAAa,EAAE,IAAI,CAACC;UACrB;QACD;QACA,IAAI,CAAChC,MAAK,GAAI,IAAII,EAAE,CAAC6B,MAAM,CAAC,QAAQ,EAAET,aAAa;MACpD;IACD,CAAC;IACDO,mBAAmBA,CAACG,KAAK,EAAE;MAC1B,IAAIA,KAAK,CAACnC,IAAG,KAAM,CAAC,EAAE;QACrBoC,OAAO,CAACC,IAAI,CAAC,aAAa;QAC1B3C,eAAe,CAAC4C,YAAY,CAAC;MAC9B;IAED,CAAC;IACDP,aAAaA,CAAA,EAAG;MACf,MAAMQ,WAAU,GAAI3C,GAAG,CAACD,QAAQ,EAAE,cAAc;MAChDE,OAAO,CAAC0C,WAAW,EAAGC,QAAQ,IAAK;QAClC,MAAMC,IAAG,GAAID,QAAQ,CAACE,GAAG,CAAC;QAC1B,IAAI,CAACC,MAAM,CAACC,QAAQ,CAACC,uBAAuB,CAACJ,IAAI;MAClD,CAAC;IACF,CAAC;IACDK,eAAeA,CAAA,EAAG;MACjB,IAAI,CAAC,IAAI,CAAC7C,MAAM,EAAE;QACjB,IAAI,CAACY,iBAAiB,CAAC;MACxB;MACA,IAAI,IAAI,CAACgB,SAAS,EAAE;QACnBO,OAAO,CAACW,GAAG,CAAC,IAAI,CAAC9C,MAAM,CAAC;QACxB,IAAI,CAACA,MAAM,CAAC+C,YAAY,CAAC,IAAI,CAACxC,OAAO;MACtC,OAAO;QACN,IAAI,CAACP,MAAM,CAACgD,aAAa,CAAC,IAAI,CAACzC,OAAO;MACvC;IACD;EACD,CAAC;EACD0C,KAAK,EAAE;IACN1C,OAAOA,CAAA,EAAG;MACT,IAAI,CAACsC,eAAe,CAAC;IACtB;EACD;AACD"},"metadata":{},"sourceType":"module","externalDependencies":[]}